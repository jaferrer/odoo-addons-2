<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <record model="ir.ui.view" id="resource_planning_cell_resource_planning">
            <field name="name">resource_planning_cell_resource_planning</field>
            <field name="model">resource.planning.cell</field>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <planning date_start="datetime_start"
                          date_stop="datetime_end"
                          headerOrientation="top"
                          mode="custom"
                          custom_mode_start="(context_today() + relativedelta(days=-7)).strftime('%Y-%m-%d')"
                          custom_mode_end="(context_today() + relativedelta(days=22)).strftime('%Y-%m-%d')"
                          default_group_by="department_id,employee_id"
                          show_current_time="false"
                          show_week_scale="true"
                          field_event_type="display_type"
                          color_field="project_color"
                          event_open_popup="true"
                          min_zoom="7 * 24 * 60 /**Js expr for 1 week in minutes**/"
                          max_zoom="3 * 31  * 24 * 60 /**Js expr for 3 months in minutes**/"
                          minute_snap="12 * 60 /**Js expr for 12 hours in minutes**/"
                          zoomKey="ctrlKey"
                          overlap_field="overlap"
                          visibleFrameQweb="false"
                          drag_data="[
                          {'field': 'project_id', 'color_field': 'color_code', 'range_full': 'day', 'group_by': 'employee_id', 'create_auto': True},
                          {'field': 'employee_id', 'range_full': 'day', 'group_by': 'project_id',  'create_auto': True}
                          ]"
                          axis="1:day"
                          scale_button="false"
                          swap_enable="true"
                />
            </field>
        </record>

        <record model="ir.ui.view" id="resource_planning_cell_form">
            <field name="name">resource_planning_cell_form</field>
            <field name="model">resource.planning.cell</field>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <form editable="top">
                    <sheet>
                        <h1>
                            <field name="employee_id"/>
                        </h1>
                        <field name="datetime_start" invisible="1"/>
                        <field name="datetime_end" invisible="1"/>
                        <group>
                            <field name="project_id"/>
                            <field name="nb_days"/>
                            <group>
                                <field name="date_start" required="1"/>
                                <field name="date_end" required="1"/>
                            </group>
                            <group>
                                <field name="period_start" required="1" widget="label_selection"/>
                                <field name="period_end" required="1"/>
                            </group>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="resource_planning_cell_search">
            <field name="name">resource_planning_cell_search</field>
            <field name="model">resource.planning.cell</field>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <search>
                    <field name="department_id"/>
                    <field name="project_id"/>
                    <field name="employee_id"/>
                    <separator/>
                    <filter name="my_favorite_project" string="My Project" domain="[('project_id.favorite_user_ids', 'in', uid)]"/>
                    <filter name="me" string="Me" domain="[('employee_id.user_id', '=', uid)]"/>
                    <filter string="This Month" name="thismonth" domain="[('date_start','&gt;=',time.strftime('%%Y-%%m-01'))]"/>
                    <filter name="grp_employee_id" string="Employee" context="{'group_by': 'employee_id'}"/>
                    <filter name="grp_project_id" string="Project" context="{'group_by': 'project_id'}"/>
                    <filter name="grp_department_id" string="Department" context="{'group_by': 'department_id'}"/>
                </search>
            </field>
        </record>

        <record model="ir.ui.view" id="project_resource_planning_project_form">
            <field name="name">project_resource_planning_project_form</field>
            <field name="model">project.project</field>
            <field name="inherit_id" ref="project.edit_project"/>
            <field name="arch" type="xml">
                <xpath expr="//group[@name='misc']" position="inside">
                    <group string="Resource Planning">
                        <field name="planning_name"/>
                        <field name="used_in_resource_planning"/>
                        <field name="color_code" widget="color"/>
                    </group>
                </xpath>
            </field>
        </record>

        <record model="ir.ui.view" id="resource_planning_cell_tree">
            <field name="name">resource_planning_cell_tree</field>
            <field name="model">resource.planning.cell</field>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <tree editable="top">
                    <field name="department_id"/>
                    <field name="employee_id"/>
                    <field name="datetime_start"/>
                    <field name="datetime_end"/>
                    <field name="nb_days"/>
                    <field name="project_id"/>
                </tree>
            </field>
        </record>

        <record id="project_resource_planning_sheet_action" model="ir.actions.act_window">
            <field name="name">Planning</field>
            <field name="res_model">resource.planning.cell</field>
            <field name="view_type">form</field>
            <field name="view_mode">planning,tree,pivot</field>
            <field name="context">{'search_default_from_this_week':True}</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to add a new Planning.
                </p>
            </field>
        </record>

        <record id="resource_planning_cell_pivot" model="ir.ui.view">
            <field name="name">resource_planning_cell_pivot</field>
            <field name="model">resource.planning.cell</field>
            <field name="priority" eval="16"/>
            <field name="arch" type="xml">
                <pivot>
                    <field name="datetime_start" interval="month" type="col"/>
                    <field name="datetime_start" interval="week" type="col"/>

                    <field name="project_id" type="row"/>

                    <field name="nb_days" type="measure"/>
                </pivot>
            </field>
        </record>

        <menuitem action="project_resource_planning_sheet_action" id="project_resource_planning_sheet_menu"
                  parent="project.menu_main_pm" sequence="1"/>

    </data>
</openerp>