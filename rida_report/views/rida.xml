<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- views -->

    <record id="rida_line_tree" model="ir.ui.view">
        <field name="name">rida.line.tree</field>
        <field name="model">rida.line</field>
        <field name="arch" type="xml">
            <tree editable="top"
                  decoration-warning="state not in ('closed', 'duplicate', 'cancel') and priority == 'p2'"
                  decoration-danger="state not in ('closed', 'duplicate', 'cancel') and priority == 'p1'"
                  decoration-muted="state in ('closed', 'duplicate', 'cancel')">
                <field name="reference"/>
                <field name="report_id"/>
                <field name="type"/>
                <field name="priority"/>
                <field name="name"/>
                <field name="user_id"
                       attrs="{'required': [('type', '=', 'action')], 'readonly': [('type', '!=', 'action')]}"/>
                <field name="state"
                       attrs="{'required': [('type', '=', 'action')], 'readonly': [('type', '!=', 'action')]}"/>
                <field name="date"
                       attrs="{'required': [('type', '=', 'action')], 'readonly': [('type', '!=', 'action')]}"/>
                <button name="action_form_view" type="object" string="Details" class="btn-primary"/>
            </tree>
        </field>
    </record>

    <record id="rida_line_tree_embed" model="ir.ui.view">
        <field name="name">rida_line_tree_embed</field>
        <field name="model">rida.line</field>
        <field name="inherit_id" ref="rida_report.rida_line_tree"/>
        <field name="mode">primary</field>
        <field name="priority">999</field>
        <field name="arch" type="xml">
            <field name="report_id" position="replace"/>
        </field>
    </record>

    <record id="rida_line_tree_embed_no_create" model="ir.ui.view">
        <field name="name">rida_line_tree_embed_no_create</field>
        <field name="model">rida.line</field>
        <field name="inherit_id" ref="rida_report.rida_line_tree_embed"/>
        <field name="mode">primary</field>
        <field name="priority">999</field>
        <field name="arch" type="xml">
            <tree position="attributes">
                <attribute name="create">0</attribute>
            </tree>
        </field>
    </record>

    <record id="rida_line_form" model="ir.ui.view">
        <field name="name">rida.line.form</field>
        <field name="model">rida.line</field>
        <field name="arch" type="xml">
            <form>
                <sheet>
                    <group col="4">
                        <field name="reference"/>
                        <field name="type"/>
                        <field name="report_id"/>
                        <field name="context"/>
                        <field name="level"/>
                        <field name="create_date" widget="date" readonly="True"/>
                        <field name="priority"/>
                        <field name="name"/>
                        <field name="user_id"
                               attrs="{'required': [('type', '=', 'action')], 'readonly': [('type', '!=', 'action')]}"/>
                        <field name="state"
                               attrs="{'required': [('type', '=', 'action')], 'readonly': [('type', '!=', 'action')]}"/>
                        <field name="date"
                               attrs="{'required': [('type', '=', 'action')], 'readonly': [('type', '!=', 'action')]}"/>
                        <field name="last_modif_date" widget="date" readonly="True"/>
                        <field name="date_done"/>
                    </group>
                    <group colspan="4">
                        <field name="comment"/>
                    </group>
                    <group colspan="4">
                        <field name="contributor_ids" widget="many2many_tags"/>
                    </group>
                    <group colspan="4">
                        <field name="attachment_ids" widget="many2many_binary"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="rida_report_tree" model="ir.ui.view">
        <field name="name">rida.report.tree</field>
        <field name="model">rida.report</field>
        <field name="arch" type="xml">
            <tree>
                <field name="code"/>
                <field name="name"/>
                <field name="project_id"/>
                <field name="theme_id"/>
                <field name="state"/>
                <field name="write_date" widget="date" readonly="True"/>
            </tree>
        </field>
    </record>

    <record id="rida_report_form" model="ir.ui.view">
        <field name="name">rida.report.form</field>
        <field name="model">rida.report</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="toggle_active" type="object" class="oe_stat_button" icon="fa-archive">
                            <field name="active" widget="boolean_button"
                                   options="{&quot;terminology&quot;: &quot;archive&quot;}"/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <div class="o_row"><field name="code"/> - <field name="name" placeholder="Name"/></div>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="theme_id"/>
                            <field name="project_id"/>
                        </group>
                        <group>
                            <field name="auth_mode"/>
                            <field name="user_ids" widget="many2many_tags"
                                   attrs="{'invisible': [('auth_mode', '!=', 'private')]}"/>
                        </group>
                    </group>
                    <notebook>
                        <page name="active_lines" string="Active lines">
                            <group col="1" string="Active lines">
                                <field name="active_line_ids"
                                       context="{'tree_view_ref': 'rida_report.rida_line_tree_embed'}"
                                       nolabel="1"/>
                            </group>
                        </page>
                        <page name="inactive_lines" string="Inactive lines">
                            <group col="1" string="Inactive lines">
                                <field name="inactive_line_ids"
                                       context="{'tree_view_ref': 'rida_report.rida_line_tree_embed_no_create'}"
                                       nolabel="1"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <record id="rida_report_search" model="ir.ui.view">
        <field name="name">rida.report.search</field>
        <field name="model">rida.report</field>
        <field name="arch" type="xml">
            <search>
                <field name="name"/>
                <field name="theme_id"/>
                <field name="project_id"/>
                <filter name="archived" string="Archived projects only" domain="[('active', '=', False)]"/>
            </search>
        </field>
    </record>

    <record id="rida_line_search" model="ir.ui.view">
        <field name="name">rida.line.search</field>
        <field name="model">rida.line</field>
        <field name="arch" type="xml">
            <search>
                <field name="reference"/>
                <field name="report_id"/>
                <field name="user_id"/>
                <field name="project_id"/>
                <field name="theme_id"/>
                <field name="comment"/>
                <field name="contributor_ids"/>
                <filter name="information_only" string="Informations only" domain="[('type', '=', 'information')]"/>
                <filter name="decision_only" string="Decisions only" domain="[('type', '=', 'decision')]"/>
                <filter name="action_only" string="Actions only" domain="[('type', '=', 'action')]"/>
                <separator/>
                <filter name="my_lines" string="My Lines"
                        domain="['|', ('user_id', '=', uid), ('contributor_ids', '=', uid)]"/>
                <filter name="own_lines" string="Lines for which I am responsible"
                        domain="[('user_id', '=', uid)]"/>
                <filter name="my_contributions" string="My contributions"
                        domain="[('contributor_ids', '=', uid)]"/>
                <separator/>
                <filter name="actions_todo" string="Actions to do"
                        domain="[('type', '=', 'action'), ('state', '=', 'open')]"/>
                <filter name="actions_done" string="Actions done"
                        domain="[('type', '=', 'action'), ('state', '=', 'done')]"/>
                <separator/>
                <group expand="0" string="Group By">
                    <filter string="RIDA" domain="[]" context="{'group_by': 'report_id'}"/>
                    <filter string="Type" domain="[]" context="{'group_by': 'type'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- actions -->

    <record model="ir.actions.act_window" id="rida_report_action">
        <field name="name">RIDA</field>
        <field name="res_model">rida.report</field>
        <field name="view_mode">tree,form</field>
    </record>

    <record model="ir.actions.act_window" id="rida_line_action">
        <field name="name">Lines</field>
        <field name="res_model">rida.line</field>
        <field name="view_mode">tree</field>
        <field name="context">{'search_default_my_lines': 1, 'search_default_actions_todo': 1}</field>
    </record>

    <!-- menuitems -->

    <menuitem
            name="RIDA"
            id="rida_root_menu"
            web_icon="rida_report,static/description/icon.png"/>

    <menuitem
            name="RIDA"
            id="rida_menu"
            parent="rida_root_menu"
            sequence="10"/>

    <menuitem
            name="RIDA"
            id="rida_report_menu"
            action="rida_report_action"
            parent="rida_menu"
            sequence="10"/>

    <menuitem
            name="My Lines"
            id="rida_line_menu"
            action="rida_line_action"
            parent="rida_menu"
            sequence="20"/>

</odoo>
