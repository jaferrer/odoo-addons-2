<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record model="ir.module.category" id="module_category_training">
            <field name="name">Training</field>
            <field name="sequence" eval="55"/>
        </record>

        <record model="res.groups" id="group_training_trainer">
            <field name="name">Trainer</field>
            <field name="category_id" ref="module_category_training"/>
            <field name="implied_ids" eval="[(6, 0, [ref('base.group_user')])]"/>
        </record>

        <record model="res.groups" id="group_training_manager">
            <field name="name">Training Manager</field>
            <field name="category_id" ref="module_category_training"/>
            <field name="implied_ids" eval="[(6, 0, [ref('group_training_trainer')])]"/>
        </record>

        <record model="ir.rule" id="rule_training_training_group_trainer">
            <field name="name">Trainings: trainers can see their own trainings</field>
            <field name="model_id" ref="model_training_training"/>
            <field name="groups" eval="[(6, 0, [ref('training_base.group_training_trainer')])]"/>
            <field name="domain_force">['|', ('user_id', '=', user.id), ('session_ids.trainer_id.user_ids', '=', user.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record model="ir.rule" id="rule_training_training_draft_group_trainer">
            <field name="name">Trainings: trainers can create/edit draft trainings only</field>
            <field name="model_id" ref="model_training_training"/>
            <field name="groups" eval="[(6, 0, [ref('training_base.group_training_trainer')])]"/>
            <field name="domain_force">[('state', '=', 'draft'), '|', ('user_id', '=', user.id), ('session_ids.trainer_id.user_ids', '=', user.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record model="ir.rule" id="rule_training_training_group_training_manager">
            <field name="name">Trainings: access to all trainings for training managers</field>
            <field name="model_id" ref="model_training_training"/>
            <field name="groups" eval="[(6, 0, [ref('training_base.group_training_manager')])]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record model="ir.rule" id="rule_training_session_group_trainer">
            <field name="name">Trainings sessions: trainers can see their own sessions</field>
            <field name="model_id" ref="model_training_session"/>
            <field name="groups" eval="[(6, 0, [ref('training_base.group_training_trainer')])]"/>
            <field name="domain_force">['|', '|', ('trainer_id.user_ids', '=', user.id), ('training_id.user_id', '=', user.id), ('training_id.session_ids.trainer_id.user_ids', '=', user.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record model="ir.rule" id="rule_training_session_draft_group_trainer">
            <field name="name">Trainings sessions: trainers can create/edit draft sessions only</field>
            <field name="model_id" ref="model_training_session"/>
            <field name="groups" eval="[(6, 0, [ref('training_base.group_training_trainer')])]"/>
            <field name="domain_force">[('state', '=', 'draft'), '|', '|', ('trainer_id.user_ids', '=', user.id), ('training_id.user_id', '=', user.id), ('training_id.session_ids.trainer_id.user_ids', '=', user.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <record model="ir.rule" id="rule_training_session_group_training_manager">
            <field name="name">Trainings sessions: access to all sessions for training managers</field>
            <field name="model_id" ref="model_training_session"/>
            <field name="groups" eval="[(6, 0, [ref('training_base.group_training_manager')])]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record model="ir.rule" id="rule_training_sitting_group_trainer">
            <field name="name">Trainings sittings: access to own sittings for trainers</field>
            <field name="model_id" ref="model_training_sitting"/>
            <field name="groups" eval="[(6, 0, [ref('training_base.group_training_trainer')])]"/>
            <field name="domain_force">['|', '|', '|', ('trainer_id.user_ids', '=', user.id), ('session_id.trainer_id.user_ids', '=', user.id), ('session_id.training_id.user_id', '=', user.id), ('session_id.training_id.session_ids.trainer_id.user_ids', '=', user.id)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <record model="ir.rule" id="rule_training_sitting_group_training_manager">
            <field name="name">Trainings sittings: access to all sittings for training managers</field>
            <field name="model_id" ref="model_training_sitting"/>
            <field name="groups" eval="[(6, 0, [ref('training_base.group_training_manager')])]"/>
            <field name="domain_force">[(1, '=', 1)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

    </data>
</openerp>